head     1.1;
branch   1.1.1;
access   ;
symbols  CMAQv4_5_1:1.1.1.1 ASMD:1.1.1;
locks    ; strict;
comment  @c @;


1.1
date     2006.03.13.19.27.27;  author sjr;  state Exp;
branches 1.1.1.1;
next     ;

1.1.1.1
date     2006.03.13.19.27.27;  author sjr;  state Exp;
branches ;
next     ;


desc
@@



1.1
log
@Initial revision
@
text
@
C***********************************************************************
C   Portions of Models-3/CMAQ software were developed or based on      *
C   information from various groups: Federal Government employees,     *
C   contractors working on a United States Government contract, and    *
C   non-Federal sources (including research institutions).  These      *
C   research institutions have given the Government permission to      *
C   use, prepare derivative works, and distribute copies of their      *
C   work in Models-3/CMAQ to the public and to permit others to do     *
C   so.  EPA therefore grants similar permissions for use of the       *
C   Models-3/CMAQ software, but users are requested to provide copies  *
C   of derivative works to the Government without restrictions as to   *
C   use by others.  Users are responsible for acquiring their own      *
C   copies of commercial software associated with Models-3/CMAQ and    *
C   for complying with vendor requirements.  Software copyrights by    *
C   the MCNC Environmental Modeling Center are used with their         *
C   permissions subject to the above restrictions.                     *
C***********************************************************************


C RCS file, release, date & time of last delta, author, state, [and locker]
C $Header: /project/work/rep/PDM/src/driver/pdm/pdriver.F,v 1.8 2005/08/29 20:31:13 jug Exp $ 

C what(1) key, module and SID; SCCS file; date and time of last delta:
C %W% %P% %G% %U%

      PROGRAM PDRIVER

C  The Plume Dynamics Model (PDM), is a preprocessor for the Plume-in-Grid(PinG)
C  module which is contained in the Chemistry-Transport Model(CTM) of CMAQ.
C  PDM simulates the Lagrangian physical dynamics (plume rise, transport
C  and expansion) of hourly releases from pre-selected, multiple large point
C  sources in the model domain. In PDM and PinG, these emissions are called
C  MEPSEs(Major Elevated Point Source Emissions); MEPSEs are a subset - the 
C  largest ones - of the "major point source"(mps) category of EPA's national
C  emissions inventory. The primary criterion for the selection of MEPSEs
C  of the large number of "mps"s is some cut-off value of the NOx emission rate.
C  Such selection of MEPSEs is performed in the SMOKE emissions processing program.
C  Two MEPSE data files are generated by SMOKE, namely:, a stack file containing
C  physical information about the stack and an emissions file containing the
C  pollutant emission rates for the particular chemical mechanism to be applied. 
C  PDM uses the MEPSE stack file information, as well as meteorological data
C  contained in several output files generated by the MCIP2.
C  PDM simulates the buoyant plume rise and subsequent transport , horizontal and
C  vertical spread of the hourly plume sections from each MEPSE source.
C  Lagrangian plume transport is simulated by the advection of plume
C  centroid, and plume spread is simulated by state-of-art parameterizations
C  of Sigma(y) and Sigma(z).

      USE HGRD_DEFN             ! horizontal domain specifications
      USE VGRD_DEFN             ! vertical layer specification
      
      IMPLICIT NONE

!     INCLUDE SUBST_HGRD_ID
!     INCLUDE SUBST_VGRD_ID
      INCLUDE SUBST_IOPARMS
      INCLUDE SUBST_IOFDESC
      INCLUDE SUBST_IODECL
      INCLUDE SUBST_CONST
      INCLUDE 'PLUME.EXT'
      
C Declare the arrays and variables.
      REAL FACTC, DDIRC, DSPDC, INITC, DX, DY

      INTEGER JDATE, JTIME, IDTSEC, NHRS, IOLDFIL
      INTEGER IMETHD, IDPLUM, ICHUST, ICHUSY, ISHEAR
      INTEGER IHRM, IPARTFLG, NSORCE, NREL, NOA, MTE, IRT( 25 )
      INTEGER NPROCS
      INTEGER LOGDEV
      CHARACTER( 96 ) :: MSG      
C .................................................................
      COMMON /MTH/ IMETHD, IDPLUM, IPARTFLG, IOLDFIL
      COMMON /SIG/ ICHUST, ICHUSY, ISHEAR
C .................................................................

      LOGDEV = INIT3( )

C set horizontal grid definition

      NPROCS = 1
      MYPE = 0

!     write( logdev,* ) 'Before HGRD_INIT :', NPROCS, MYPE

      IF ( .NOT. HGRD_INIT ( NPROCS, MYPE ) ) THEN
         MSG = '*** Failure defining horizontal domain'
!        CALL M3WARN ( 'PDRIVER', 0, 0, MSG )
         CALL M3EXIT ( 'PDRIVER', 0, 0, MSG, XSTAT1 )
         END IF

!     write( logdev,* ) 'After HGRD_INIT'
C define the vertical layer structure
      IF ( .NOT. VGRD_INIT() ) THEN
          MSG = '*** Failure defining vertical structure'
          CALL M3WARN ( 'PDRIVER', 0, 0, MSG )
          CALL M3EXIT ( 'PDRIVER', 0, 0, MSG, XSTAT1 )
          END IF
      write(LOGDEV,*) 'After HGRD_INIT and VGRD_INIT'
      
C Read in initial parameters & open I/O files for the model run.

      CALL GENRLIN ( JDATE, JTIME, IDTSEC, NHRS, IHRM, DX, DY,
     &               NSORCE, FACTC, DDIRC, DSPDC, INITC, NREL, NOA, IRT )

C Perform the plume dynamics processing.
      MTE = NOA + MT
   
      CALL PDMMAIN( JDATE, JTIME, IDTSEC, NHRS, IHRM, DX, DY,
     &              NSORCE, FACTC, DDIRC, DSPDC, INITC, NREL, NOA, MTE, IRT )
      
C --------------------------------------------------------------------
C End of the simulation.

      CLOSE ( 25 )
      CLOSE ( 11 )
      CLOSE ( 8 )

      IF ( SHUT3() ) THEN
         WRITE ( LOGDEV,91000 )
     &  '>>---->  Program PDM completed successfully  <----<< '
      ELSE
         WRITE ( LOGDEV,94000 )
     &      'FATAL ERROR shutting down Models-3 I/O'
      ENDIF

91000 FORMAT ( //5X, A, // )
94000 FORMAT ( //5X, '*** ERROR ABORT in PDM ***',
     &          /5X, A, // )

      END
@


1.1.1.1
log
@CMAQv4_5_1 release
@
text
@@
