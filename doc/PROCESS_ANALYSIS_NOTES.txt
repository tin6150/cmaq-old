                     PROCESS_ANALYSIS_NOTES  15 Mar 2006


 The following describes procedures for conducting process analyses with 
 the CMAQ modeling system.  Process analysis is a diagnostic tool that can 
 be used by the modeling analyst to quantify contributions of individual 
 science processes to model predicted concentrations. Such information is 
 useful for understanding a model's predictions and for determining why 
 predictions change when the model configuration or when model inputs are 
 changed.

 Technical details of the CMAQ implementation of process analysis are 
 contained in Chapter 16 of the "Science Algorithms of the EPA Models-3 
 Community Multiscale Air Quality (CMAQ) Modeling System (EPA-600/R-
 99/030), and will not be repeated here.  The focus here is on the 
 operational steps necessary to invoke process analysis in the CMAQ system. 
 However, this science document has not been upgraded to reflect 
 modifications to process analysis, required by the new mass-conserving 
 advection scheme now available in the CMAQ chemical transport model 
 (CCTM).  

 The CMAQ build scripts included with this release are set up such that 
 process analysis is de-activated.  This is accomplished by including three 
 "no-op" include files that effectively turn off process analysis -
 PA_CTL.EXT, PA_DAT.EXT and PA_CMN.EXT.  Whenever process analysis is to be 
 omitted, these three no-op files should be used when the CCTM is compiled.

 To activate Process Analysis, the three no-op files must be replaced with 
 three include files that define how the information is to be collected 
 during model simulations.  These files are generated by running the 
 Process Analysis Control Program (PACP), for which bldit and run scripts 
 are provided with this release. The steps to invoke process analysis 
 follow.

  1.  Create an ASCII text file containing process analysis commands.  See 
      Chapter 16 of the aforementioned science document for command rules 
      and syntax. New syntax for the mass-conserving advection scheme in 
      the CCTM is discussed in special note d), below.

  2.  Build the PACP using the bldit script.  Note that the CVSROOT 
      directory should point to the PROCAN subdirectory of the source 
      archive (e.g., in the accompanying bldit script, the variable 
      "Project" is set to $M3MODEL/PROCAN). The only change to the release 
      script that may be required involves the chemical mechanism. The 
      script variable "Mechanism" must be set to the chemical mechanism 
      that will be used in the CCTM.

  3.  Run the PACP using the run script.  The input file to be used can be 
      defined using the environment variable PACP_INFILE. (If this 
      environment variable is not set, the PACP will look for an input file 
      named "pa.inp" in the run directory.)  The output of the PACP 
      consists of four ASCII files: the aforementioned three include files 
      (PA_CTL.EXT, PA_CMN.EXT, and PA_DAT.EXT), and a PA_REPORT file that 
      is included for informational purposes.  All four output files will 
      be placed in the run directory.

  4.  Use the three include files generated by the PACP program in lieu of 
      the no-op files when the CCTM is built (i.e., change the "ICL_PA" 
      variable in the CCTM bldit script to point to the path of the include 
      files generated by the PACP). The process analysis output files 
      generated by the CCTM will be included with the other CCTM output 
      files in the OUTDIR specied in the run script for the CCTM.  See 
      special note b) below regarding setting the output domain before 
      running the CCTM.


 Special notes:

  a)  When invoking process analysis, be sure to use the same chemical 
      mechanism when building the PACP and the CCTM.  At present no 
      consistency check is performed, and the use of inconsistent 
      mechanisms will produce erroneous results.

  b)  As described in the science document, the domain for process analysis 
      can be set smaller than the CCTM computational domain to reduce 
      computer resources requirements.  The science document indicates that 
      the process analysis output domain is set using the OUTPUT_DOMAIN 
      command in the PACP input file.  That is no longer the case.  The 
      process analysis domain is now set in the CMAQ run script via the 
      environment variables PA_BCOL_ECOL, PA_BROW_EROW, and PA_BLEV_ELEV. 
      When process analysis is invoked, these variables must be un-
      commented and set appropriately.  The PACP is now programmed to 
      terminate with an error message if the OUTPUT_DOMAIN command is 
      included in the PACP input file.

  c)  An example PACP input file and corresponding output files are 
      included in the "data" directory of this release, but these files 
      have not been used in the example CCTM run.

  d)  There's a new "base" operator, HADV for the mass-conserving advection 
      scheme that combines the X- and Y-advection. These cannot be simply 
      separated as is the case for PPM advection.  All the operators that 
      combine the base operators have been renamed to contain only four 
      characters, like the base operators. This was done to allow a larger, 
      maximum 11 character length of the chemical species names, which get 
      prepended by the operator name (with the additional "_" character) to 
      become the I/O-API variable names (16 character limit) written to the 
      output file(s).
      
      New combined operator names (created from base operator names):
      1)  ADV2 = XADV + YADV
      2)  ADV3 = XADV + YADV + ZADV
      3)  MADV = HADV + ZADV
      4)  TADV = XADV + YADV + ZADV + ADJC
      5)  TDIF = HDIF + VDIF
      6)  TRAN = XADV + YADV + ZADV + ADJC + HDIF + VDIF
      7)  TRNM = HADV + ZADV + HDIF + VDIF

     (1) is horizontal advection for the PPM scheme
     (2) is total advection without mixing adjustment for the PPM scheme
     (3) is total advection for the mass-conserving scheme
     (4) is total advection for the PPM scheme
     (5) is total diffusion
     (6) is total transport for the PPM scheme
     (7) is total transport for the mass-conserving scheme

     (1), (2), (4), and (6) can apply only to the PPM advection, whereas 
     (3) and (7) can apply only to mass-conserving advection.
